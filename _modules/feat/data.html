

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>feat.data &mdash; FEAT 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'0.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> FEAT
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FEAT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>feat.data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for feat.data</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="sd">&quot;&quot;&quot;Class definitions.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">nltools.data</span> <span class="k">import</span> <span class="n">Adjacency</span><span class="p">,</span> <span class="n">design_matrix</span>
<span class="kn">from</span> <span class="nn">nltools.stats</span> <span class="k">import</span> <span class="p">(</span><span class="n">downsample</span><span class="p">,</span>
                           <span class="n">upsample</span><span class="p">,</span>
                           <span class="n">transform_pairwise</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nltools.utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">set_decomposition_algorithm</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="k">import</span> <span class="n">pairwise_distances</span><span class="p">,</span> <span class="n">cosine_similarity</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="k">import</span> <span class="n">check_random_state</span>
<span class="kn">from</span> <span class="nn">feat.utils</span> <span class="k">import</span> <span class="n">read_affectiva</span><span class="p">,</span> <span class="n">read_facet</span><span class="p">,</span> <span class="n">read_openface</span><span class="p">,</span> <span class="n">wavelet</span><span class="p">,</span> <span class="n">calc_hist_auc</span><span class="p">,</span> <span class="n">load_h5</span><span class="p">,</span> <span class="n">get_resource_path</span>
<span class="kn">from</span> <span class="nn">feat.plotting</span> <span class="k">import</span> <span class="n">plot_face</span>
<span class="kn">from</span> <span class="nn">nilearn.signal</span> <span class="k">import</span> <span class="n">clean</span>
<span class="kn">from</span> <span class="nn">pandas.core.index</span> <span class="k">import</span> <span class="n">Index</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">convolve</span>

<div class="viewcode-block" id="FexSeries"><a class="viewcode-back" href="../../feat.html#feat.data.FexSeries">[docs]</a><span class="k">class</span> <span class="nc">FexSeries</span><span class="p">(</span><span class="n">Series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a sub-class of pandas series. While not having additional methods</span>
<span class="sd">    of it&#39;s own required to retain normal slicing functionality for the</span>
<span class="sd">    Fex class, i.e. how slicing is typically handled in pandas.</span>
<span class="sd">    All methods should be called on Fex below.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_metadata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;sampling_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="s1">&#39;sessions&#39;</span><span class="p">,</span><span class="s1">&#39;fex_columns&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sampling_freq&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FexSeries</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FexSeries</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor_expanddim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Fex</span></div>

<div class="viewcode-block" id="Fex"><a class="viewcode-back" href="../../feat.html#feat.data.Fex">[docs]</a><span class="k">class</span> <span class="nc">Fex</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Fex is a class to represent facial expression data. It is essentially</span>
<span class="sd">        an enhanced pandas df, with extra attributes and methods. Methods</span>
<span class="sd">        always return a new design matrix instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: (str) path to file</span>
<span class="sd">        sampling_freq (float, optional): sampling rate of each row in Hz;</span>
<span class="sd">                                         defaults to None</span>
<span class="sd">        features (pd.Dataframe, optional): features that correspond to each</span>
<span class="sd">                                          Fex row</span>
<span class="sd">        sessions: Unique values indicating rows associated with a specific</span>
<span class="sd">                  session (e.g., trial, subject, etc). Must be a 1D array of</span>
<span class="sd">                  n_samples elements; defaults to None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># __metaclass__  = abc.ABCMeta</span>
    <span class="n">_metadata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;sampling_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="s1">&#39;sessions&#39;</span><span class="p">,</span><span class="s1">&#39;fex_columns&#39;</span><span class="p">]</span>
    <span class="c1"># def __finalize__(self, other, *args, **kwargs):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Propagates metdata from other to self.</span>
    <span class="c1">#     Should be called at the end of each function to ensure class and attributes are propagated.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     for name in self._metadata:</span>
    <span class="c1">#         object.__setattr_(self, name , getattr(other, name, None))</span>
    <span class="c1">#     return self</span>
    <span class="c1">#</span>
    <span class="c1">#     DataFrame.__finalize__ = __finalize__</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sampling_freq&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fex_columns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fex_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Make sure sessions is same length as data.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fex_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fex_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to import _metadata to fex_columns&#39;</span><span class="p">)</span>

        <span class="c1"># Set _metadata attributes on series: Kludgy solution</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sampling_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Fex</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor_sliced</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FexSeries</span>

    <span class="k">def</span> <span class="nf">_ixs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Override indexing to ensure Fex._metadata is propogated correctly</span>
<span class="sd">            when integer indexing</span>

<span class="sd">        i : int, slice, or sequence of integers</span>
<span class="sd">        axis : int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_ixs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

        <span class="c1"># Override columns</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Notes</span>
<span class="sd">            -----</span>
<span class="sd">            If slice passed, the resulting data will be a view</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="c1"># need to return view</span>
                <span class="n">lab_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">lab_slice</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">Index</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_take</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">index_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="c1"># if the values returned are not the same length</span>
                <span class="c1"># as the index (iow a not found value), iget returns</span>
                <span class="c1"># a 0-len ndarray. This is effectively catching</span>
                <span class="c1"># a numpy error (as numpy should really raise)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">iget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">index_len</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="n">index_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor_sliced</span><span class="p">(</span>
                    <span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">fastpath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span> <span class="n">sessions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span>

                <span class="c1"># this is a cached value, mark it so</span>
                <span class="n">result</span><span class="o">.</span><span class="n">_set_as_cached</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<div class="viewcode-block" id="Fex.read_file"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loads file into FEX class &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<div class="viewcode-block" id="Fex.plot"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plots face file &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<div class="viewcode-block" id="Fex.calc_pspi"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.calc_pspi">[docs]</a>    <span class="k">def</span> <span class="nf">calc_pspi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculates PSPI (Prkachin and Solomon Pain Intensity) levels which is metric of pain as a linear combination of facial action units(AU).</span>
<span class="sd">        The included AUs are brow lowering (AU4), eye tightening (AU6,7), eye closure(AU43,45), nose wrinkling (AU9) and lip raise (AU10).</span>
<span class="sd">        Originally PSPI is calculated based on AU intensity scale of 1-5 but for Facet data it is in Evidence units.</span>

<span class="sd">        Citation:</span>
<span class="sd">        Prkachin and Solomon, (2008) The structure, reliability and validity of pain expression: Evidence from Patients with shoulder pain, Pain, vol 139, non 2 pp 267-274</span>

<span class="sd">        Formula:</span>
<span class="sd">        PSPI = AU4 + max(AU6, AU7) + max(AU9, AU10) + AU43 (or AU45 for Openface)</span>

<span class="sd">        Return:</span>
<span class="sd">            PSPI calculated at each frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Fex.info"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print class meta data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="n">attr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{self.__class__}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>  <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attr_list</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fex.itersessions"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.itersessions">[docs]</a>    <span class="k">def</span> <span class="nf">itersessions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Iterate over Fex sessions as (session, series) pairs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            it: a generator that iterates over the sessions of the fex instance</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="o">==</span><span class="n">x</span><span class="p">,</span> <span class="p">:]</span></div>

<div class="viewcode-block" id="Fex.append"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Append a new Fex object to an existing object</span>

<span class="sd">        Args:</span>
<span class="sd">            data: (Fex) Fex instance to append</span>
<span class="sd">            session_id: session label</span>
<span class="sd">            axis: ([0,1]) Axis to append. Rows=0, Cols=1</span>
<span class="sd">        Returns:</span>
<span class="sd">            Fex instance</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Make sure data is a Fex instance.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">session_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">session_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span> <span class="o">!=</span> <span class="n">data</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Make sure Fex objects have the same &#39;</span>
                                 <span class="s1">&#39;sampling frequency&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">],</span>
                                               <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
                                               <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                                     <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">session_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">session_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">data</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">out</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Different number of features in new dataset.&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
                <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">features</span>
            <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span>
                                     <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">sessions</span><span class="p">):</span>
                            <span class="n">out</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Both sessions must be identical.&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span>
                <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sessions</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
                    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">features</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Axis must be 1 or 0.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Fex.regress"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.regress">[docs]</a>    <span class="k">def</span> <span class="nf">regress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">NotImplemented</span></div>

<div class="viewcode-block" id="Fex.ttest"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.ttest">[docs]</a>    <span class="k">def</span> <span class="nf">ttest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">NotImplemented</span></div>

<div class="viewcode-block" id="Fex.predict"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">NotImplemented</span></div>

<div class="viewcode-block" id="Fex.downsample"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.downsample">[docs]</a>    <span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Downsample Fex columns. Relies on nltools.stats.downsample,</span>
<span class="sd">           but ensures that returned object is a Fex object.</span>

<span class="sd">        Args:</span>
<span class="sd">            target(float): downsampling target, typically in samples not</span>
<span class="sd">                            seconds</span>
<span class="sd">            kwargs: additional inputs to nltools.stats.downsample</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df_ds</span> <span class="o">=</span> <span class="n">downsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                           <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ds_features</span> <span class="o">=</span> <span class="n">downsample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                                     <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                     <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ds_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">df_ds</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">ds_features</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fex.upsample"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.upsample">[docs]</a>    <span class="k">def</span> <span class="nf">upsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">target_type</span><span class="o">=</span><span class="s1">&#39;hz&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Upsample Fex columns. Relies on nltools.stats.upsample,</span>
<span class="sd">            but ensures that returned object is a Fex object.</span>

<span class="sd">        Args:</span>
<span class="sd">            target(float): upsampling target, default &#39;hz&#39; (also &#39;samples&#39;,</span>
<span class="sd">                           &#39;seconds&#39;)</span>
<span class="sd">            kwargs: additional inputs to nltools.stats.upsample</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df_us</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                         <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">target_type</span><span class="o">=</span><span class="n">target_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">us_features</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                                   <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                   <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">target_type</span><span class="o">=</span><span class="n">target_type</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">us_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">df_us</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">us_features</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fex.distance"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate distance between rows within a Fex() instance.</span>

<span class="sd">            Args:</span>
<span class="sd">                method: type of distance metric (can use any scikit learn or</span>
<span class="sd">                        sciypy metric)</span>

<span class="sd">            Returns:</span>
<span class="sd">                dist: Outputs a 2D distance matrix.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">Adjacency</span><span class="p">(</span><span class="n">pairwise_distances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                         <span class="n">matrix_type</span><span class="o">=</span><span class="s1">&#39;Distance&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fex.rectification"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.rectification">[docs]</a>    <span class="k">def</span> <span class="nf">rectification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes time points when the face position moved</span>
<span class="sd">            more than N standard deviations from the mean.</span>

<span class="sd">            Args:</span>
<span class="sd">                std (default 3): standard deviation from mean to remove outlier face locations</span>
<span class="sd">            Returns:</span>
<span class="sd">                data: cleaned FEX object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#### TODO: CHECK IF FACET OR FIND WAY TO DO WITH OTHER ONES TOO #####</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">face_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FaceRectX&#39;</span><span class="p">,</span><span class="s1">&#39;FaceRectY&#39;</span><span class="p">,</span><span class="s1">&#39;FaceRectHeight&#39;</span><span class="p">,</span><span class="s1">&#39;FaceRectWidth&#39;</span><span class="p">]</span>
        <span class="n">x_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FaceRectX</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">x_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FaceRectX</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">y_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FaceRectY</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">y_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FaceRectY</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">x_bool</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FaceRectX</span><span class="o">&gt;</span><span class="n">std</span><span class="o">*</span><span class="n">x_std</span><span class="o">+</span><span class="n">x_m</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FaceRectX</span><span class="o">&lt;</span><span class="n">x_m</span><span class="o">-</span><span class="n">std</span><span class="o">*</span><span class="n">x_std</span><span class="p">)</span>
        <span class="n">y_bool</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FaceRectY</span><span class="o">&gt;</span><span class="n">std</span><span class="o">*</span><span class="n">y_std</span><span class="o">+</span><span class="n">y_m</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FaceRectY</span><span class="o">&lt;</span><span class="n">y_m</span><span class="o">-</span><span class="n">std</span><span class="o">*</span><span class="n">y_std</span><span class="p">)</span>
        <span class="n">xy_bool</span> <span class="o">=</span> <span class="n">x_bool</span> <span class="o">|</span> <span class="n">y_bool</span>
        <span class="n">cleaned</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">xy_bool</span><span class="p">,</span><span class="n">face_columns</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fex_columns</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">cleaned</span></div>


<div class="viewcode-block" id="Fex.baseline"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.baseline">[docs]</a>    <span class="k">def</span> <span class="nf">baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Reference a Fex object to a baseline.</span>

<span class="sd">            Args:</span>
<span class="sd">                method: {&#39;median&#39;, &#39;mean&#39;, &#39;begin&#39;, FexSeries instance}. Will subtract baseline</span>
<span class="sd">                        from Fex object (e.g., mean, median).  If passing a Fex</span>
<span class="sd">                        object, it will treat that as the baseline.</span>
<span class="sd">                normalize: (str). Can normalize results of baseline.</span>
<span class="sd">                            Values can be [None, &#39;db&#39;,&#39;pct&#39;]; default None.</span>
<span class="sd">                ignore_sessions: (bool) If True, will ignore Fex.sessions</span>
<span class="sd">                                 information. Otherwise, method will be applied</span>
<span class="sd">                                 separately to each unique session.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Fex object</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ignore_sessions</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="s1">&#39;begin&#39;</span><span class="p">:</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="p">(</span><span class="n">Series</span><span class="p">,</span> <span class="n">FexSeries</span><span class="p">)):</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">baseline</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a FexSeries not a FexSeries Instance.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not implemented please use {mean, median, Fex}&#39;</span> <span class="o">%</span> <span class="n">baseline</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalize</span> <span class="o">==</span> <span class="s1">&#39;db&#39;</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">out</span> <span class="o">-</span> <span class="n">baseline</span><span class="p">)</span><span class="o">/</span><span class="n">baseline</span>
            <span class="k">if</span> <span class="n">normalize</span> <span class="o">==</span> <span class="s1">&#39;pct&#39;</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">out</span> <span class="o">-</span> <span class="n">baseline</span><span class="p">)</span><span class="o">/</span><span class="n">baseline</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">-</span> <span class="n">baseline</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itersessions</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                    <span class="n">baseline</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                    <span class="n">baseline</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="s1">&#39;begin&#39;</span><span class="p">:</span>
                    <span class="n">baseline</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="p">(</span><span class="n">Series</span><span class="p">,</span> <span class="n">FexSeries</span><span class="p">)):</span>
                    <span class="n">baseline</span> <span class="o">=</span> <span class="n">baseline</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a FexSeries not a FexSeries Instance.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not implemented please use {mean, median, Fex}&#39;</span> <span class="o">%</span> <span class="n">baseline</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">normalize</span> <span class="o">==</span> <span class="s1">&#39;db&#39;</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">baseline</span><span class="p">)</span><span class="o">/</span><span class="n">baseline</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">normalize</span> <span class="o">==</span> <span class="s1">&#39;pct&#39;</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">baseline</span><span class="p">)</span><span class="o">/</span><span class="n">baseline</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">baseline</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                             <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">sessions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fex.clean"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">confounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">low_pass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_pass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ensure_finite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Clean Time Series signal</span>

<span class="sd">            This function wraps nilearn functionality and can filter, denoise,</span>
<span class="sd">            detrend, etc.</span>

<span class="sd">            See http://nilearn.github.io/modules/generated/nilearn.signal.clean.html</span>

<span class="sd">            This function can do several things on the input signals, in</span>
<span class="sd">            the following order:</span>
<span class="sd">                - detrend</span>
<span class="sd">                - standardize</span>
<span class="sd">                - remove confounds</span>
<span class="sd">                - low- and high-pass filter</span>

<span class="sd">            If Fex.sessions is not None, sessions will be cleaned separately.</span>

<span class="sd">            Args:</span>
<span class="sd">                confounds: (numpy.ndarray, str or list of Confounds timeseries)</span>
<span class="sd">                            Shape must be (instant number, confound number),</span>
<span class="sd">                            or just (instant number,). The number of time</span>
<span class="sd">                            instants in signals and confounds must be identical</span>
<span class="sd">                            (i.e. signals.shape[0] == confounds.shape[0]). If a</span>
<span class="sd">                            string is provided, it is assumed to be the name of</span>
<span class="sd">                            a csv file containing signals as columns, with an</span>
<span class="sd">                            optional one-line header. If a list is provided,</span>
<span class="sd">                            all confounds are removed from the input signal,</span>
<span class="sd">                            as if all were in the same array.</span>

<span class="sd">                low_pass: (float) low pass cutoff frequencies in Hz.</span>
<span class="sd">                high_pass: (float) high pass cutoff frequencies in Hz.</span>
<span class="sd">                detrend: (bool) If detrending should be applied on timeseries</span>
<span class="sd">                         (before confound removal)</span>
<span class="sd">                standardize: (bool) If True, returned signals are set to unit</span>
<span class="sd">                             variance.</span>
<span class="sd">                ensure_finite: (bool) If True, the non-finite values</span>
<span class="sd">                               (NANs and infs) found in the data will be</span>
<span class="sd">                               replaced by zeros.</span>
<span class="sd">                ignore_sessions: (bool) If True, will ignore Fex.sessions</span>
<span class="sd">                                 information. Otherwise, method will be applied</span>
<span class="sd">                                 separately to each unique session.</span>
<span class="sd">            Returns:</span>
<span class="sd">                cleaned Fex instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_sessions</span><span class="p">:</span>
                <span class="n">sessions</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sessions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sessions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="n">detrend</span><span class="p">,</span>
                                                 <span class="n">standardize</span><span class="o">=</span><span class="n">standardize</span><span class="p">,</span>
                                                 <span class="n">confounds</span><span class="o">=</span><span class="n">confounds</span><span class="p">,</span>
                                                 <span class="n">low_pass</span><span class="o">=</span><span class="n">low_pass</span><span class="p">,</span>
                                                 <span class="n">high_pass</span><span class="o">=</span><span class="n">high_pass</span><span class="p">,</span>
                                                 <span class="n">ensure_finite</span><span class="o">=</span><span class="n">ensure_finite</span><span class="p">,</span>
                                                 <span class="n">t_r</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">),</span>
                                                 <span class="n">sessions</span><span class="o">=</span><span class="n">sessions</span><span class="p">,</span>
                                                 <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
                                <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                                <span class="n">sessions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fex.decompose"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.decompose">[docs]</a>    <span class="k">def</span> <span class="nf">decompose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Decompose Fex instance</span>

<span class="sd">        Args:</span>
<span class="sd">            algorithm: (str) Algorithm to perform decomposition</span>
<span class="sd">                        types=[&#39;pca&#39;,&#39;ica&#39;,&#39;nnmf&#39;,&#39;fa&#39;]</span>
<span class="sd">            axis: dimension to decompose [0,1]</span>
<span class="sd">            n_components: (int) number of components. If None then retain</span>
<span class="sd">                        as many as possible.</span>

<span class="sd">        Returns:</span>
<span class="sd">            output: a dictionary of decomposition parameters</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;decomposition_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_decomposition_algorithm</span><span class="p">(</span>
                                                    <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
                                                    <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                    <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">com_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;c</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;decomposition_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;components&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;decomposition_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">com_names</span><span class="p">),</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;decomposition_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                                        <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">com_names</span><span class="p">),</span>
                                            <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                            <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                                            <span class="n">sessions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;decomposition_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;components&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;decomposition_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                                            <span class="n">columns</span><span class="o">=</span><span class="n">com_names</span><span class="p">),</span>
                                               <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                               <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                                               <span class="n">sessions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;decomposition_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">components_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">com_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Fex.extract_mean"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.extract_mean">[docs]</a>    <span class="k">def</span> <span class="nf">extract_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract mean of each feature</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                    by sessions if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Fex: mean values for each feature</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ignore_sessions</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
            <span class="n">feats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="n">feats</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itersessions</span><span class="p">():</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">feats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>
            <span class="n">feats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="n">feats</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                  <span class="n">sessions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fex.extract_min"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.extract_min">[docs]</a>    <span class="k">def</span> <span class="nf">extract_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract minimum of each feature</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                    by sessions if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Fex: (Fex) minimum values for each feature</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ignore_sessions</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
            <span class="n">feats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;min_&#39;</span> <span class="o">+</span> <span class="n">feats</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itersessions</span><span class="p">():</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">feats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>
            <span class="n">feats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;min_&#39;</span> <span class="o">+</span> <span class="n">feats</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                  <span class="n">sessions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fex.extract_max"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.extract_max">[docs]</a>    <span class="k">def</span> <span class="nf">extract_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract maximum of each feature</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                    by sessions if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            fex: (Fex) maximum values for each feature</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ignore_sessions</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
            <span class="n">feats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;max_&#39;</span> <span class="o">+</span> <span class="n">feats</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itersessions</span><span class="p">():</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">feats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>
            <span class="n">feats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;max_&#39;</span> <span class="o">+</span> <span class="n">feats</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                  <span class="n">sessions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fex.extract_summary"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.extract_summary">[docs]</a>    <span class="k">def</span> <span class="nf">extract_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract summary of multiple features</span>

<span class="sd">        Args:</span>
<span class="sd">            mean: (bool) extract mean of features</span>
<span class="sd">            max: (bool) extract max of features</span>
<span class="sd">            min: (bool) extract min of features</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                    by sessions if available.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fex: (Fex)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mean</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_mean</span><span class="p">(</span><span class="n">ignore_sessions</span><span class="o">=</span><span class="n">ignore_sessions</span><span class="p">,</span>
                                               <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_max</span><span class="p">(</span><span class="n">ignore_sessions</span><span class="o">=</span><span class="n">ignore_sessions</span><span class="p">,</span>
                                               <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_min</span><span class="p">(</span><span class="n">ignore_sessions</span><span class="o">=</span><span class="n">ignore_sessions</span><span class="p">,</span>
                                               <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Fex.extract_wavelet"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.extract_wavelet">[docs]</a>    <span class="k">def</span> <span class="nf">extract_wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">num_cyc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span>
                        <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform feature extraction by convolving with a complex morlet</span>
<span class="sd">            wavelet</span>

<span class="sd">            Args:</span>
<span class="sd">                freq: (float) frequency to extract</span>
<span class="sd">                num_cyc: (float) number of cycles for wavelet</span>
<span class="sd">                mode: (str) feature to extract, e.g.,</span>
<span class="sd">                            [&#39;complex&#39;,&#39;filtered&#39;,&#39;phase&#39;,&#39;magnitude&#39;,&#39;power&#39;]</span>
<span class="sd">                ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                        by sessions if available.</span>
<span class="sd">            Returns:</span>
<span class="sd">                convolved: (Fex instance)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wav</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span> <span class="n">num_cyc</span><span class="o">=</span><span class="n">num_cyc</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ignore_sessions</span><span class="p">:</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">convolve</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()}),</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itersessions</span><span class="p">():</span>
                <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">convolve</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()}),</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">)</span>
                <span class="n">convolved</span> <span class="o">=</span> <span class="n">convolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="n">convolved</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">is</span> <span class="s1">&#39;filtered&#39;</span><span class="p">:</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">convolved</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">is</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">convolved</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">is</span> <span class="s1">&#39;magnitude&#39;</span><span class="p">:</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">convolved</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">is</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">convolved</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mode must be [&#39;complex&#39;,&#39;filtered&#39;,&#39;phase&#39;,&quot;</span>
                             <span class="s2">&quot;&#39;magnitude&#39;,&#39;power&#39;]&quot;</span><span class="p">)</span>
        <span class="n">convolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">convolved</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                                   <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                                   <span class="n">sessions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span>
        <span class="n">convolved</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">round</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">mode</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">return</span> <span class="n">convolved</span></div>

<div class="viewcode-block" id="Fex.extract_multi_wavelet"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.extract_multi_wavelet">[docs]</a>    <span class="k">def</span> <span class="nf">extract_multi_wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=.</span><span class="mi">06</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=.</span><span class="mi">66</span><span class="p">,</span> <span class="n">bank</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Convolve with a bank of morlet wavelets. Wavelets are equally</span>
<span class="sd">            spaced from min to max frequency. See extract_wavelet for more</span>
<span class="sd">            information and options.</span>

<span class="sd">            Args:</span>
<span class="sd">                min_freq: (float) minimum frequency to extract</span>
<span class="sd">                max_freq: (float) maximum frequency to extract</span>
<span class="sd">                bank: (int) size of wavelet bank</span>
<span class="sd">                num_cyc: (float) number of cycles for wavelet</span>
<span class="sd">                mode: (str) feature to extract, e.g.,</span>
<span class="sd">                            [&#39;complex&#39;,&#39;filtered&#39;,&#39;phase&#39;,&#39;magnitude&#39;,&#39;power&#39;]</span>
<span class="sd">                ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                        by sessions if available.</span>
<span class="sd">            Returns:</span>
<span class="sd">                convolved: (Fex instance)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">,</span> <span class="n">bank</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_wavelet</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                              <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                              <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                              <span class="n">sessions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fex.extract_boft"><a class="viewcode-back" href="../../feat.html#feat.data.Fex.extract_boft">[docs]</a>    <span class="k">def</span> <span class="nf">extract_boft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=.</span><span class="mi">06</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=.</span><span class="mi">66</span><span class="p">,</span> <span class="n">bank</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract Bag of Temporal features</span>
<span class="sd">        Args:</span>
<span class="sd">            min_freq: maximum frequency of temporal filters</span>
<span class="sd">            max_freq: minimum frequency of temporal filters</span>
<span class="sd">            bank: number of temporal filter banks, filters are on exponential scale</span>

<span class="sd">        Returns:</span>
<span class="sd">            wavs: list of Morlet wavelets with corresponding freq</span>
<span class="sd">            hzs:  list of hzs for each Morlet wavelet</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First generate the wavelets</span>
        <span class="n">target_hz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">,</span><span class="n">bank</span><span class="p">)</span>
        <span class="n">wavs</span><span class="p">,</span> <span class="n">hzs</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqs</span><span class="p">):</span>
            <span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">wavelet</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="n">target_hz</span><span class="p">))</span>
            <span class="n">wavs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span>
            <span class="n">hzs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">wavs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hzs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hzs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># # check asymptotes at lowest freq</span>
        <span class="c1"># asym = wavs[-1,:10].sum()</span>
        <span class="c1"># if asym &gt; .001:</span>
        <span class="c1">#     print(&quot;Lowest frequency asymptotes at %2.8f &quot; %(wavs[-1,:10].sum()))</span>

        <span class="c1"># Convolve data with wavelets</span>
        <span class="n">Feats2Use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">Feats2Use</span><span class="p">:</span>
            <span class="n">_d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">feat</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span>
            <span class="k">assert</span> <span class="n">_d</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Data contains NaNs. Cannot convolve. &quot;</span>
            <span class="k">for</span> <span class="n">iw</span><span class="p">,</span> <span class="n">cm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wavs</span><span class="p">):</span>
                <span class="n">convolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">arr</span><span class="o">=</span><span class="n">_d</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="c1"># Extract bin features.</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">convolved</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calc_hist_auc</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                <span class="c1"># 6 bins hardcoded from calc_hist_auc</span>
                <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_hz_&#39;</span><span class="o">+</span><span class="n">hzs</span><span class="p">[</span><span class="n">iw</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">feat</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
                <span class="n">colnames</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;neg&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_hz_&#39;</span><span class="o">+</span><span class="n">hzs</span><span class="p">[</span><span class="n">iw</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">feat</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">T</span>
                <span class="n">out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">feats</span><span class="p">,</span> <span class="n">out</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_freq</span><span class="p">,</span>
                              <span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span></div></div>
<div class="viewcode-block" id="Facet"><a class="viewcode-back" href="../../feat.html#feat.data.Facet">[docs]</a><span class="k">class</span> <span class="nc">Facet</span><span class="p">(</span><span class="n">Fex</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Facet is a subclass of Fex.</span>
<span class="sd">    You can use the Facet subclass to load iMotions-FACET data files.</span>
<span class="sd">    It will also have Facet specific methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Facet.read_file"><a class="viewcode-back" href="../../feat.html#feat.data.Facet.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">read_facet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Facet.calc_pspi"><a class="viewcode-back" href="../../feat.html#feat.data.Facet.calc_pspi">[docs]</a>    <span class="k">def</span> <span class="nf">calc_pspi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;AU4&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;AU6&#39;</span><span class="p">,</span><span class="s1">&#39;AU7&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;AU9&#39;</span><span class="p">,</span><span class="s1">&#39;AU10&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;AU43&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Facet.plot"><a class="viewcode-back" href="../../feat.html#feat.data.Facet.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_n</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vectorfield</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">muscles</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">gaze</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plot facial representation of data</span>
<span class="sd">        Args:</span>
<span class="sd">            row_n: the row of data to use</span>
<span class="sd">            model: sklearn PLSRegression instance</span>
<span class="sd">            vectorfield: (dict) {&#39;target&#39;:target_array,&#39;reference&#39;:reference_array}</span>
<span class="sd">            muscles: (dict) {&#39;muscle&#39;: color}</span>
<span class="sd">            ax: matplotlib axis handle</span>
<span class="sd">            color: matplotlib color</span>
<span class="sd">            linewidth: matplotlib linewidth</span>
<span class="sd">            linestyle: matplotlib linestyle</span>
<span class="sd">            gaze: array of gaze vectors (len(5))</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AU1&#39;</span><span class="p">,</span><span class="s1">&#39;AU2&#39;</span><span class="p">,</span> <span class="s1">&#39;AU4&#39;</span><span class="p">,</span><span class="s1">&#39;AU5&#39;</span><span class="p">,</span><span class="s1">&#39;AU6&#39;</span><span class="p">,</span><span class="s1">&#39;AU7&#39;</span><span class="p">,</span><span class="s1">&#39;AU9&#39;</span><span class="p">,</span><span class="s1">&#39;AU10&#39;</span><span class="p">,</span> <span class="s1">&#39;AU12&#39;</span><span class="p">,</span><span class="s1">&#39;AU14&#39;</span><span class="p">,</span><span class="s1">&#39;AU15&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;AU17&#39;</span><span class="p">,</span><span class="s1">&#39;AU18&#39;</span><span class="p">,</span><span class="s1">&#39;AU20&#39;</span><span class="p">,</span> <span class="s1">&#39;AU23&#39;</span><span class="p">,</span><span class="s1">&#39;AU24&#39;</span><span class="p">,</span><span class="s1">&#39;AU25&#39;</span><span class="p">,</span><span class="s1">&#39;AU26&#39;</span><span class="p">,</span><span class="s1">&#39;AU28&#39;</span><span class="p">,</span><span class="s1">&#39;AU43&#39;</span><span class="p">,</span><span class="s1">&#39;Pitch&#39;</span><span class="p">,</span><span class="s1">&#39;Roll&#39;</span><span class="p">,</span><span class="s1">&#39;Yaw&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">row_n</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Row number out of range.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">au</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">:</span>
                <span class="n">aun</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span>
                <span class="n">au</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aun</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">row_n</span><span class="p">])</span>
            <span class="n">au</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">au</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">load_h5</span><span class="p">(</span><span class="s1">&#39;facet.h5&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">muscles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">muscles</span><span class="p">[</span><span class="s1">&#39;facet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_face</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">au</span><span class="o">=</span><span class="n">au</span><span class="p">,</span> <span class="n">vectorfield</span><span class="o">=</span><span class="n">vectorfield</span><span class="p">,</span> <span class="n">muscles</span><span class="o">=</span><span class="n">muscles</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unable to plot data:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Affdex"><a class="viewcode-back" href="../../feat.html#feat.data.Affdex">[docs]</a><span class="k">class</span> <span class="nc">Affdex</span><span class="p">(</span><span class="n">Fex</span><span class="p">):</span>
<div class="viewcode-block" id="Affdex.read_file"><a class="viewcode-back" href="../../feat.html#feat.data.Affdex.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_cols</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">read_affectiva</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">orig_cols</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Affdex.plot"><a class="viewcode-back" href="../../feat.html#feat.data.Affdex.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_n</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vectorfield</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">muscles</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">gaze</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plot facial representation of data</span>
<span class="sd">        Args:</span>
<span class="sd">            row_n: the row of data to use</span>
<span class="sd">            model: sklearn PLSRegression instance</span>
<span class="sd">            vectorfield: (dict) {&#39;target&#39;:target_array,&#39;reference&#39;:reference_array}</span>
<span class="sd">            muscles: (dict) {&#39;muscle&#39;: color}</span>
<span class="sd">            ax: matplotlib axis handle</span>
<span class="sd">            color: matplotlib color</span>
<span class="sd">            linewidth: matplotlib linewidth</span>
<span class="sd">            linestyle: matplotlib linestyle</span>
<span class="sd">            gaze: array of gaze vectors (len(5))</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;AU01&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;innerBrowRaise&quot;</span><span class="p">,</span> <span class="s2">&quot;browRaise&quot;</span><span class="p">,</span> <span class="s2">&quot;browFurrow&quot;</span><span class="p">,</span> <span class="s2">&quot;eyeWiden&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;cheekRaise&quot;</span><span class="p">,</span>  <span class="s2">&quot;lidTighten&quot;</span><span class="p">,</span> <span class="s2">&quot;noseWrinkle&quot;</span><span class="p">,</span> <span class="s2">&quot;upperLipRaise&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;smile&quot;</span><span class="p">,</span> <span class="s2">&quot;dimpler&quot;</span><span class="p">,</span> <span class="s2">&quot;lipCornerDepressor&quot;</span><span class="p">,</span> <span class="s2">&quot;chinRaise&quot;</span><span class="p">,</span> <span class="s2">&quot;lipStretch&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;lipPress&quot;</span><span class="p">,</span><span class="s2">&quot;mouthOpen&quot;</span><span class="p">,</span><span class="s2">&quot;jawDrop&quot;</span><span class="p">,</span> <span class="s2">&quot;eyeClosure&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AU01&quot;</span><span class="p">,</span> <span class="s2">&quot;AU02&quot;</span><span class="p">,</span> <span class="s2">&quot;AU04&quot;</span><span class="p">,</span> <span class="s2">&quot;AU05&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;AU06&quot;</span><span class="p">,</span>  <span class="s2">&quot;AU07&quot;</span><span class="p">,</span> <span class="s2">&quot;AU9&quot;</span><span class="p">,</span> <span class="s2">&quot;AU10&quot;</span><span class="p">,</span> <span class="s2">&quot;AU12&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;AU14&quot;</span><span class="p">,</span> <span class="s2">&quot;AU15&quot;</span><span class="p">,</span> <span class="s2">&quot;AU17&quot;</span><span class="p">,</span> <span class="s2">&quot;AU20&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;AU24&quot;</span><span class="p">,</span><span class="s2">&quot;AU25&quot;</span><span class="p">,</span><span class="s2">&quot;AU26&quot;</span><span class="p">,</span> <span class="s2">&quot;AU43&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">row_n</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Row number out of range.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">au</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">:</span>
                <span class="n">aun</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span>
                <span class="n">au</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aun</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">row_n</span><span class="p">]</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">au</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">au</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_face</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">au</span><span class="o">=</span><span class="n">au</span><span class="p">,</span> <span class="n">vectorfield</span><span class="o">=</span><span class="n">vectorfield</span><span class="p">,</span> <span class="n">muscles</span><span class="o">=</span><span class="n">muscles</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unable to plot data:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Openface"><a class="viewcode-back" href="../../feat.html#feat.data.Openface">[docs]</a><span class="k">class</span> <span class="nc">Openface</span><span class="p">(</span><span class="n">Fex</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Openface is a subclass of Fex.</span>
<span class="sd">    You can use the Openface subclass to load Openface data files.</span>
<span class="sd">    It will also have Openface specific methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Openface.read_file"><a class="viewcode-back" href="../../feat.html#feat.data.Openface.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">read_openface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Openface.calc_pspi"><a class="viewcode-back" href="../../feat.html#feat.data.Openface.calc_pspi">[docs]</a>    <span class="k">def</span> <span class="nf">calc_pspi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;AU04_r&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;AU06_r&#39;</span><span class="p">,</span><span class="s1">&#39;AU07_r&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;AU09_r&#39;</span><span class="p">,</span><span class="s1">&#39;AU10_r&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;AU45_r&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Openface.plot"><a class="viewcode-back" href="../../feat.html#feat.data.Openface.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_n</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vectorfield</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">muscles</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gaze_vecs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plot facial representation of data</span>
<span class="sd">        Args:</span>
<span class="sd">            row_n: the row of data to use</span>
<span class="sd">            model: sklearn PLSRegression instance</span>
<span class="sd">            vectorfield: (dict) {&#39;target&#39;:target_array,&#39;reference&#39;:reference_array}</span>
<span class="sd">            muscles: (dict) {&#39;muscle&#39;: color}</span>
<span class="sd">            ax: matplotlib axis handle</span>
<span class="sd">            color: matplotlib color</span>
<span class="sd">            linewidth: matplotlib linewidth</span>
<span class="sd">            linestyle: matplotlib linestyle</span>
<span class="sd">            gaze: (bool) whether to draw gaze based on data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AU01_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU02_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU04_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU05_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU06_r&#39;</span><span class="p">,</span>
       <span class="s1">&#39;AU07_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU09_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU10_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU12_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU14_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU15_r&#39;</span><span class="p">,</span>
       <span class="s1">&#39;AU17_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU20_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU23_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU25_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU26_r&#39;</span><span class="p">,</span> <span class="s1">&#39;AU45_r&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">row_n</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Row number out of range.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">au</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">:</span>
                <span class="n">aun</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span>
                <span class="n">au</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aun</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">row_n</span><span class="p">])</span>
            <span class="n">au</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">au</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">gaze</span><span class="p">:</span>
                <span class="n">gaze_dat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gaze_0_x&#39;</span><span class="p">,</span> <span class="s1">&#39;gaze_0_y&#39;</span><span class="p">,</span> <span class="s1">&#39;gaze_1_x&#39;</span><span class="p">,</span> <span class="s1">&#39;gaze_1_y&#39;</span><span class="p">]</span>
                <span class="n">gaze</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="n">gaze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">gaze_dat</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">row_n</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">gaze_vecs</span><span class="p">:</span>
                    <span class="n">gaze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gaze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gaze</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_face</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">au</span><span class="o">=</span><span class="n">au</span><span class="p">,</span> <span class="n">vectorfield</span><span class="o">=</span><span class="n">vectorfield</span><span class="p">,</span> <span class="n">muscles</span><span class="o">=</span><span class="n">muscles</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unable to plot data:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="Fextractor"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor">[docs]</a><span class="k">class</span> <span class="nc">Fextractor</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fextractor is a class that extracts and merges features from a Fex instance</span>
<span class="sd">    in preparation for data analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Fextractor.mean"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fex_object</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract mean of each feature</span>

<span class="sd">        Args:</span>
<span class="sd">            fex_object: (Fex) Fex instance to extract features from.</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                    by sessions if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Fex: mean values for each feature</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fex_object</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a Fex object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fex_object</span><span class="o">.</span><span class="n">extract_mean</span><span class="p">(</span><span class="n">ignore_sessions</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fextractor.max"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fex_object</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract maximum of each feature</span>

<span class="sd">        Args:</span>
<span class="sd">            fex_object: (Fex) Fex instance to extract features from.</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                             by sessions if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            fex: (Fex) maximum values for each feature</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fex_object</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a Fex object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fex_object</span><span class="o">.</span><span class="n">extract_max</span><span class="p">(</span><span class="n">ignore_sessions</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>


<div class="viewcode-block" id="Fextractor.min"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fex_object</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract minimum of each feature</span>

<span class="sd">        Args:</span>
<span class="sd">            fex_object: (Fex) Fex instance to extract features from.</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                    by sessions if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Fex: (Fex) minimum values for each feature</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fex_object</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a Fex object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fex_object</span><span class="o">.</span><span class="n">extract_min</span><span class="p">(</span><span class="n">ignore_sessions</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fextractor.summary"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fex_object</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract summary of multiple features</span>
<span class="sd">        Args:</span>
<span class="sd">            fex_object: (Fex) Fex instance to extract features from.</span>
<span class="sd">            mean: (bool) extract mean of features</span>
<span class="sd">            max: (bool) extract max of features</span>
<span class="sd">            min: (bool) extract min of features</span>
<span class="sd">            ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                    by sessions if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            fex: (Fex)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fex_object</span><span class="o">.</span><span class="n">extract_summary</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span><span class="nb">min</span><span class="p">,</span><span class="n">ignore_sessions</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fextractor.wavelet"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.wavelet">[docs]</a>    <span class="k">def</span> <span class="nf">wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fex_object</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">num_cyc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform feature extraction by convolving with a complex morlet</span>
<span class="sd">            wavelet</span>

<span class="sd">            Args:</span>
<span class="sd">                fex_object: (Fex) Fex instance to extract features from.</span>
<span class="sd">                freq: (float) frequency to extract</span>
<span class="sd">                num_cyc: (float) number of cycles for wavelet</span>
<span class="sd">                mode: (str) feature to extract, e.g.,</span>
<span class="sd">                            [&#39;complex&#39;,&#39;filtered&#39;,&#39;phase&#39;,&#39;magnitude&#39;,&#39;power&#39;]</span>
<span class="sd">                ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                        by sessions if available.</span>
<span class="sd">            Returns:</span>
<span class="sd">                convolved: (Fex instance)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fex_object</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a Fex object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fex_object</span><span class="o">.</span><span class="n">extract_wavelet</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">num_cyc</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">ignore_sessions</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fextractor.multi_wavelet"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.multi_wavelet">[docs]</a>    <span class="k">def</span> <span class="nf">multi_wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fex_object</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=.</span><span class="mi">06</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=.</span><span class="mi">66</span><span class="p">,</span> <span class="n">bank</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Convolve with a bank of morlet wavelets. Wavelets are equally</span>
<span class="sd">            spaced from min to max frequency. See extract_wavelet for more</span>
<span class="sd">            information and options.</span>

<span class="sd">            Args:</span>
<span class="sd">                fex_object: (Fex) Fex instance to extract features from.</span>
<span class="sd">                min_freq: (float) minimum frequency to extract</span>
<span class="sd">                max_freq: (float) maximum frequency to extract</span>
<span class="sd">                bank: (int) size of wavelet bank</span>
<span class="sd">                num_cyc: (float) number of cycles for wavelet</span>
<span class="sd">                mode: (str) feature to extract, e.g.,</span>
<span class="sd">                            [&#39;complex&#39;,&#39;filtered&#39;,&#39;phase&#39;,&#39;magnitude&#39;,&#39;power&#39;]</span>
<span class="sd">                ignore_sessions: (bool) ignore sessions or extract separately</span>
<span class="sd">                                        by sessions if available.</span>
<span class="sd">            Returns:</span>
<span class="sd">                convolved: (Fex instance)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fex_object</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a Fex object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fex_object</span><span class="o">.</span><span class="n">extract_multi_wavelet</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fextractor.boft"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.boft">[docs]</a>    <span class="k">def</span> <span class="nf">boft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fex_object</span><span class="p">,</span> <span class="n">min_freq</span><span class="o">=.</span><span class="mi">06</span><span class="p">,</span> <span class="n">max_freq</span><span class="o">=.</span><span class="mi">66</span><span class="p">,</span> <span class="n">bank</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract Bag of Temporal features</span>
<span class="sd">        Args:</span>
<span class="sd">            fex_object: (Fex) Fex instance to extract features from.</span>
<span class="sd">            min_freq: maximum frequency of temporal filters</span>
<span class="sd">            max_freq: minimum frequency of temporal filters</span>
<span class="sd">            bank: number of temporal filter banks, filters are on exponential scale</span>

<span class="sd">        Returns:</span>
<span class="sd">            wavs: list of Morlet wavelets with corresponding freq</span>
<span class="sd">            hzs:  list of hzs for each Morlet wavelet</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fex_object</span><span class="p">,</span> <span class="p">(</span><span class="n">Fex</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass in a Fex object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fex_object</span><span class="o">.</span><span class="n">extract_boft</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fextractor.merge"><a class="viewcode-back" href="../../feat.html#feat.data.Fextractor.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_format</span><span class="o">=</span><span class="s1">&#39;long&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Merge all extracted features to a single dataframe</span>
<span class="sd">        Args:</span>
<span class="sd">            format: (str) Output format of merged data. Can be set to &#39;long&#39; or</span>
<span class="sd">                    &#39;wide&#39;. Defaults to long.</span>
<span class="sd">        Returns:</span>
<span class="sd">            merged: (DataFrame) DataFrame containing merged features extracted</span>
<span class="sd">                    from a Fex instance.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracted_features</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;sessions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">index</span>

        <span class="k">if</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s1">&#39;long&#39;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;sessions&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s1">&#39;wide&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">out</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jin Hyun Cheong, TianKang Xie, Sophie Byrne, Nathaniel Hanes, Luke Chang 

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>